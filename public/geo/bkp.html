<!DOCTYPE html>
<html ng-app="demoapp">
  <head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Firebase -->
    <script src="js/angular.min.js"></script>
    <script src="https://www.gstatic.com/firebasejs/3.6.6/firebase.js"></script>

    <!-- AngularFire -->
    <script src="https://cdn.firebase.com/libs/angularfire/2.3.0/angularfire.min.js"></script>
	<head>
	<title>GEo</title>
	<meta charset="utf-8"/>
	<style type="text/css">
	
	p{
		width: 300px;
		height: 300px;
	}
</style>



 <script type="text/javascript" src="https://maps.google.com/maps/api/js?key=AIzaSyCZsJEv3FWv3GEDWsXDulUtD5NjtY0eEtM&language=pt-BR&mode=transit"></script>
  <script>
	var watchID = null;
    //-23,5486. Longitude de Praça da Sé é -46,6392
        var app = angular.module("demoapp", ["firebase"]);


        var config = {
            apiKey: "AIzaSyDnsrFKJ00l3vye_AGwVt9womLPJGx51As",
            authDomain: "chatsocket-2626b.firebaseapp.com",
            databaseURL: "https://chatsocket-2626b.firebaseio.com",
            projectId: "chatsocket-2626b",
            storageBucket: "chatsocket-2626b.appspot.com",
            messagingSenderId: "1075121073644"
        };
        firebase.initializeApp(config);



        app.controller('MarkersAngularTemplateController', [ '$scope', '$firebaseObject', function($scope, $firebaseObject, leafletMarkerEvents) {
            angular.extend($scope, {
                SP: {
                    lat: -23.5486,
                    lng: -46.6392,
                    zoom: 8
                },
                data: {markers: {}}
            });

             var ref = firebase.database().ref().child("markers");
              // download the data into a local object
              var syncObject = $firebaseObject(ref);
              // synchronize the object with a three-way data binding
              // click on `index.html` above to see it used in the DOM!
              syncObject.$bindTo($scope, "data.markers");

		    var optn = {
				enableHighAccuracy: true,
				timeout: Infinity,
				maximumAge: 0	
			};

			syncObject.$loaded().then(function(items) {
			    this.markers = items; // populated array
			    $scope.markers = items; // populated array
			    console.log(items);
			    if(navigator.geolocation) {
			        navigator.geolocation.getCurrentPosition(function(position) {
			        		$scope.markers.m1.lat = position.coords.latitude;
			                $scope.markers.m1.lng = position.coords.longitude;
			        });
			        navigator.geolocation.watchPosition(function(position) {
			        		$scope.markers.m1.lat = position.coords.latitude;
			                $scope.markers.m1.lng = position.coords.longitude;
			        });
			    }
			    $scope.init();
			  }.bind(this));

		$scope.init = function(){
				navigator.geolocation.watchPosition(function(position) {
			        		$scope.markers.m1.lat = position.coords.latitude;
			                $scope.markers.m1.lng = position.coords.longitude;
			        });
			
		}
		} ]);
</script>

</head>
<body ng-controller="MarkersAngularTemplateController">
<div id="map"></div>
<div id="response">aqui</div>
<button>Stop</button>
<pre>
{{markers.m1}}
<br>
{{markers}}
</body>

</html>