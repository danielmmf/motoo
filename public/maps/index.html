<!DOCTYPE html>
<html ng-app="demoapp">
  <head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="js/angular.js"></script>
    <!-- Firebase -->
    <script src="https://www.gstatic.com/firebasejs/3.6.6/firebase.js"></script>

    <!-- AngularFire -->
    <script src="https://cdn.firebase.com/libs/angularfire/2.3.0/angularfire.min.js"></script>
    <script src="js/leaflet.js"></script>
    <script src="js/angular-leaflet-directive.js"></script>
    <link rel="stylesheet" href="css/leaflet.css" />
    <style media="screen" type="text/css">
        .form-popup {
            width: 200px;
        }
    </style>
    <script>
    //-23,5486. Longitude de Praça da Sé é -46,6392
        var app = angular.module("demoapp", ["leaflet-directive","firebase"]);


        var config = {
            apiKey: "AIzaSyDnsrFKJ00l3vye_AGwVt9womLPJGx51As",
            authDomain: "chatsocket-2626b.firebaseapp.com",
            databaseURL: "https://chatsocket-2626b.firebaseio.com",
            projectId: "chatsocket-2626b",
            storageBucket: "chatsocket-2626b.appspot.com",
            messagingSenderId: "1075121073644"
        };
        firebase.initializeApp(config);



        app.controller('MarkersAngularTemplateController', [ '$scope', '$firebaseObject', function($scope, $firebaseObject) {
            angular.extend($scope, {
                SP: {
                    lat: -23.5486,
                    lng: -46.6392,
                    zoom: 8
                },
                data: {markers: {}}
            });

             var ref = firebase.database().ref().child("markers");
              // download the data into a local object
              var syncObject = $firebaseObject(ref);
              // synchronize the object with a three-way data binding
              // click on `index.html` above to see it used in the DOM!
              syncObject.$bindTo($scope, "data.markers");

            $scope.addMarkers = function() {
                $scope.data.markers = {};
                angular.extend($scope.data, { angularInterpolatedMessage : "Angular interpolated message!"});
                angular.extend($scope.data, {
                    markers: {
                        m1: {
                            lat: -23.505,
                            lng: -46.6309,
                            compileMessage: false,
                            message: "I'm a static marker",
                        },
                        m2: {
                            lat: -23.53,
                            lng: -46.63,
                            focus: true,
                            message: "<div ng-include src=\"'views/template.html'\"></div>",
                            draggable: true,
                        },
                        m3: {
                            lat: -23.52,
                            lng: -46.631,
                           message: "<div ng-include src=\"'views/pop.html'\"></div>",
                            compileMessage: true
                        }
                    }
                });
            };

            $scope.removeMarkers = function() {
                $scope.data.markers = {};
            }

            $scope.altera = function() {
                $scope.data.markers.m1 = {
                            lat: -23.5,
                            lng: $scope.data.markers.m1.lng-0.02,
                            compileMessage: false,
                            message: "I'm a static marker cuzao",
                        };
            }

            $scope.newMarker = function() {
                $scope.data.markers = {
                        m1: {
                            lat: 51.505,
                            lng: -0.08,
                            compileMessage: false,
                            message: "I'm a static marker",
                        },
                        m2: {
                            lat: 51,
                            lng: 0,
                            focus: true,
                            message: "<div ng-include src=\"'views/template.html'\"></div>",
                            draggable: true,
                        },
                        m3: {
                            lat: 51,
                            lng: -1,
                            getMessageScope: function () { return $scope; },
                            message: "<p>{{data.angularInterpolatedMessage}}</p>",
                            compileMessage: true
                        },m4: {
                            lat: 51.506,
                            lng: -0.08,
                            compileMessage: false,
                            message: "I'm a static marker,,,,,,,,,,,,,,,,,",
                        },
                        m5: {
                            lat: 51.505,
                            lng: 0,
                            focus: true,
                            message: "<div ng-include src=\"'views/template.html'\"></div>",
                            draggable: true,
                        },
                        m6: {
                            lat: 51.504,
                            lng: -1,
                            message: "<div ng-include src=\"'views/pop.html'\"></div>",
                            compileMessage: true
                        }
                    };
            }

         

            $scope.addMarkers();
        } ]);
        app.controller('ViewController', ['$scope', function($scope) {
            $scope.user = {}
            $scope.greet = function(user) {
              alert('Oi ' + user.name)
            }
        } ]);

        app.controller('PopController', ['$scope', function($scope) {
            $scope.atualiza = function() {
              alert('Esse aqui é  clicado no usuario ');
            }
        } ]);
    </script>
  </head>
  <body ng-controller="MarkersAngularTemplateController">
      <leaflet  lf-center="SP" markers="data.markers" height="480px" width="100%"></leaflet>
      <h1>reflete o movimento aqui</h1>
      
    <hr>
      {{data}}
      
  </body>
</html>